<Window x:Class="AsusUefiImagePackEditor.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:vm="clr-namespace:AsusUefiImagePackEditor.UI.ViewModels"
        xmlns:cv="clr-namespace:AsusUefiImagePackEditor.UI.Converters"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance vm:MainWindowViewModel}"
        Title="{Binding WindowTitle}"
        Height="576" Width="960"
        MinHeight="576" MinWidth="960"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <DrawingBrush x:Key="CheckerboardBrush" Viewport="0,0,20,20" ViewportUnits="Absolute" TileMode="Tile">
            <DrawingBrush.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="White">
                        <GeometryDrawing.Geometry>
                            <RectangleGeometry Rect="0,0,20,20" />
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                    <GeometryDrawing Brush="#FFEEEEEE">
                        <GeometryDrawing.Geometry>
                            <GeometryGroup>
                                <RectangleGeometry Rect="0,0,10,10" />
                                <RectangleGeometry Rect="10,10,10,10" />
                            </GeometryGroup>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                </DrawingGroup>
            </DrawingBrush.Drawing>
        </DrawingBrush>

        <cv:NullToValueConverter x:Key="NullToCollapsedConverter"
                                 NullValue="{x:Static Visibility.Collapsed}"
                                 NotNullValue="{x:Static Visibility.Visible}" />
        <cv:NullToValueConverter x:Key="NullToVisibleConverter"
                                 NullValue="{x:Static Visibility.Visible}"
                                 NotNullValue="{x:Static Visibility.Collapsed}" />
        <cv:BoolToValueConverter x:Key="BoolToCollapsedConverter"
                                 TrueValue="{x:Static Visibility.Collapsed}"
                                 FalseValue="{x:Static Visibility.Visible}" />
        <cv:BoolToValueConverter x:Key="BoolToVisibleConverter"
                                 TrueValue="{x:Static Visibility.Visible}"
                                 FalseValue="{x:Static Visibility.Collapsed}" />
        <cv:NullToValueConverter x:Key="NullToTrueConverter" >
            <cv:NullToValueConverter.NullValue>
                <sys:Boolean>True</sys:Boolean>
            </cv:NullToValueConverter.NullValue>
            <cv:NullToValueConverter.NotNullValue>
                <sys:Boolean>False</sys:Boolean>
            </cv:NullToValueConverter.NotNullValue>
        </cv:NullToValueConverter>
        <cv:NullToValueConverter x:Key="NullToFalseConverter" >
            <cv:NullToValueConverter.NullValue>
                <sys:Boolean>False</sys:Boolean>
            </cv:NullToValueConverter.NullValue>
            <cv:NullToValueConverter.NotNullValue>
                <sys:Boolean>True</sys:Boolean>
            </cv:NullToValueConverter.NotNullValue>
        </cv:NullToValueConverter>

        <Style x:Key="MenuIconTextBlock" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets" />
            <Setter Property="FontSize" Value="14" />
        </Style>

        <ContextMenu x:Key="ResourceItemContextMenu">
            <MenuItem Header="Replace Resource"
                      Command="{Binding PlacementTarget.DataContext.ReplaceResourceCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                <MenuItem.Icon>
                    <TextBlock Text="&#xE74B;" Style="{StaticResource MenuIconTextBlock}" />
                </MenuItem.Icon>
            </MenuItem>
            <!--<MenuItem Header="Copy Resource ID"
            Command="{Binding PlacementTarget.DataContext.CopyIdCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
            <MenuItem.Icon>
            <TextBlock Text="&#xE8C8;" Style="{StaticResource MenuIconTextBlock}" />
            </MenuItem.Icon>
            </MenuItem>-->
            <Separator />
            <MenuItem Header="Save Preview As..."
                      Command="{Binding PlacementTarget.DataContext.SavePreviewCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                <MenuItem.Icon>
                    <TextBlock Text="&#xE74E;" Style="{StaticResource MenuIconTextBlock}" />
                </MenuItem.Icon>
            </MenuItem>
        </ContextMenu>

        <ContextMenu x:Key="PreviewContextMenu">
            <MenuItem Header="Replace Resource"
                      Command="{Binding PlacementTarget.DataContext.ReplaceResourceCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                <MenuItem.Icon>
                    <TextBlock Text="&#xE74B;" Style="{StaticResource MenuIconTextBlock}" />
                </MenuItem.Icon>
            </MenuItem>
            <Separator />
            <MenuItem Header="Save Preview As..."
                      Command="{Binding PlacementTarget.DataContext.SavePreviewCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                <MenuItem.Icon>
                    <TextBlock Text="&#xE74E;" Style="{StaticResource MenuIconTextBlock}" />
                </MenuItem.Icon>
            </MenuItem>
        </ContextMenu>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenFileCommand}" />
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding SaveCommand}" />
        <KeyBinding Key="S" Modifiers="Control+Shift" Command="{Binding SaveAsCommand}" />
        <KeyBinding Key="R" Modifiers="Control" Command="{Binding SelectedResource.ReplaceResourceCommand}" />
        <KeyBinding Key="P" Modifiers="Control" Command="{Binding SelectedResource.SavePreviewCommand}" />
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0">
            <Menu BorderThickness="0">
                <MenuItem Header="File" FontSize="14">
                    <MenuItem Header="Open" Command="{Binding OpenFileCommand}" InputGestureText="Ctrl+O" FontSize="13" />
                    <MenuItem Header="Save" Command="{Binding SaveCommand}" InputGestureText="Ctrl+S" FontSize="13" />
                    <MenuItem Header="Save As..." Command="{Binding SaveAsCommand}" InputGestureText="Ctrl+Shift+S" FontSize="13" />
                    <Separator />
                    <MenuItem Header="Exit" Command="{Binding ExitCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}" InputGestureText="Alt+F4" FontSize="13" />
                </MenuItem>
                <MenuItem Header="Resource" FontSize="14" IsEnabled="{Binding SelectedResource, Converter={StaticResource NullToFalseConverter}}">
                    <MenuItem Header="Replace Resource" Command="{Binding SelectedResource.ReplaceResourceCommand}" InputGestureText="Ctrl+R" FontSize="13" />
                    <Separator />
                    <MenuItem Header="Save Preview As..." Command="{Binding SelectedResource.SavePreviewCommand}" InputGestureText="Ctrl+P" FontSize="13" />
                </MenuItem>
                <MenuItem Header="Help" FontSize="14">
                    <MenuItem Header="About UEFI Resource Editor" Command="{Binding ShowAboutCommand}" FontSize="13" />
                </MenuItem>
            </Menu>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320" />
                <ColumnDefinition Width="3" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ListView Grid.Column="0"
                      ItemsSource="{Binding Resources}"
                      SelectedItem="{Binding SelectedResource}"
                      BorderThickness="0"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="ContextMenu" Value="{StaticResource ResourceItemContextMenu}" />
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="8,6" Margin="4,2">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Border Margin="0,0,8,0" Background="{StaticResource CheckerboardBrush}">
                                    <Image Grid.Column="0"
                                           Source="{Binding PreviewImage}"
                                           Width="40" Height="40"
                                           Stretch="Uniform" />
                                </Border>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{Binding DisplayName}"
                                               FontWeight="SemiBold"
                                               FontSize="13"
                                               TextTrimming="CharacterEllipsis" />
                                    <TextBlock FontSize="11">
                                        <Run Text="Size:" />
                                        <Run Text="{Binding SizeText, Mode=OneWay}" />
                                        <TextBlock Text="| Modified" FontSize="11" Visibility="{Binding IsModified, Converter={StaticResource BoolToVisibleConverter}}" />
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <GridSplitter Grid.Column="1"
                          Width="5"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch" />

            <Border Grid.Column="2" BorderThickness="1" ContextMenu="{StaticResource PreviewContextMenu}" DataContext="{Binding SelectedResource}">
                <Grid>
                    <Border Background="{StaticResource CheckerboardBrush}">
                        <Image Source="{Binding PreviewImage}"
                               Stretch="Uniform"
                               RenderOptions.BitmapScalingMode="Fant" />
                    </Border>

                    <TextBlock Text="Select a resource to preview"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontSize="18"
                               FontStyle="Italic"
                               Visibility="{Binding Converter={StaticResource NullToVisibleConverter}}" />
                </Grid>
            </Border>
        </Grid>

        <Border Grid.Row="2">
            <StatusBar FontSize="12" Padding="8,4">
                <StatusBarItem Visibility="{Binding CurrentFilePath, Converter={StaticResource NullToVisibleConverter}}">
                    <TextBlock Text="No resources loaded. Open a UEFI resource package file."
                               FontStyle="Italic"
                               HorizontalAlignment="Center" />
                </StatusBarItem>
                <StatusBarItem Visibility="{Binding CurrentFilePath, Converter={StaticResource NullToCollapsedConverter}}">
                    <TextBlock>
                        <Run Text="{Binding CurrentFilePath, Mode=OneWay}" />
                        <Run Text="{Binding Resources.Count, Mode=OneWay, StringFormat=({0})}" />
                    </TextBlock>
                </StatusBarItem>
                <StatusBarItem HorizontalAlignment="Right" Visibility="{Binding SelectedResource, Converter={StaticResource NullToCollapsedConverter}}">
                    <TextBlock FontSize="12" DataContext="{Binding SelectedResource}">
                        <Run Text="Format:" />
                        <Run Text="{Binding PreviewImage.Format, Mode=OneWay}" />
                        |
                        <Run Text="Dimensions:" />
                        <Run Text="{Binding PreviewImage.PixelWidth, Mode=OneWay, StringFormat={}{0}px}" />
                        Ã—
                        <Run Text="{Binding PreviewImage.PixelHeight, Mode=OneWay, StringFormat={}{0}px}" />
                    </TextBlock>
                </StatusBarItem>
            </StatusBar>
        </Border>
    </Grid>
</Window>
